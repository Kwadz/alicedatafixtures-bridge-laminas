TODO: move to common, use Symfony DI with mapper and compiler pass?
